
商家是不是能报某个活动,或者是否能报哪个商品会校验很多规则，比如对报名时间、商家身份等的校验。在之前整个校验模块完全是一个黑盒，商家、产品都不知道商家会过什么规则，只有开发通过代码看目前系统里面有什么规则。然后集团今年的一个大目标就是商家体验这一块，所以我们想做到所见即所得，系统里过了什么规则都将他产品化的表达出来。


原来的规则实现是这样的：有一个Rule的父类，他有一个check方法，所有的规则都实现check方法，并且把Rule定义在规则枚举类中，在校验的时候就获取所有的Rule进行校验。规则枚举类根据场景进行分类，例如活动报名场景，商品报名场景，商品编辑场景等等。这样有几个问题：
1. 如果要修改rule返回的文案，就要拉分支改代码发布
2. 很多校验逻辑写到了web应用中
3. 某一个规则中堆积了很多代码
4. 后端维护成本高，当商家报名失败来咨询时，只能由开发去翻代码看是被哪个规则卡主了
5. 每个业务需要校验的规则不同，比如聚划算业务可能不校验A B两个规则，那就要在这两个规则中分别写一个判断来跳过聚划算业务

所以我们需要把规则抽象成一个模型，然后通过平台方式录入这个规则。规则模型里面包含ID、唯一的code、规则名称、规则描述、所属的领域模型

还有一个规则配置模型，他将什么情况下执行什么规则抽象出来了。包含的字段有执行表达式、规则code列表、操作类型ID

整个分为两部分：
1. 平台能力建设
当需要新增一个valve的时候，需要在平台上录入这个valve的详细信息，包括他的code、名称、介绍

2. 规则迁移
将老体系的rule转换成valve,对不合理的rule进行拆分或者归并 







规则校验分为两种形式，一种是快速失败，有一个规则校验失败就返回结果。一种是穿透执行，校验所有的规则后返回全部的结果。