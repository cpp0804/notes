## 参考博文
[什么是协程？](https://zhuanlan.zhihu.com/p/172471249)


[TOC]

# 进程
进程是资源分配的基本单位，进程有自己的内存区域

## 为什么需要进程
CPU没一个时刻只能执行一条指令，但如果只执行一个程序的任务，其他程序都无法得到相应。所以CPU利用分时调度让每个程序都得到时间片执行。
但是每个程序的实例他们执行的数据和代码是不一样的，所以当一个任务切换到另一个任务的时候，需要保存当前任务的执行现场。所以就有了进程的概念，作为执行的基本单元，使用单独的内存维护着对应的上下文环境


# 线程
线程是运行调度的基本单位，一个进程当中有很多线程，他是执行任务的实体。

一个进程中的线程共享进程中的资源。

每个线程都有一个程序计数器（记录要执行的下一条指令），一组寄存器（保存当前线程的工作变量），堆栈（记录执行历史，其中每一帧保存了一个已经调用但未返回的过程）


![存储内容](./pic/进程和线程_存储内容.png)


# 协程
协程，英文Coroutines，是一种比线程更加轻量级的存在。正如一个进程可以拥有多个线程一样，一个线程也可以拥有多个协程
![协程](./pic/进程和线程_协程.png)
![协程位子](./pic/进程和线程_协程位子.jpeg)


当线程数量非常多的时候，产生的问题：
1. 系统线程会占用非常多的内存空间
2. 过多的线程切换会占用大量的系统时间。


协程运行在线程之上，当一个协程执行完成后，可以选择主动让出，让另一个协程运行。协程并没有增加线程数量，只是在线程的基础之上通过分时复用的方式运行多个协程，而且协程的切换在用户态完成，切换的代价比线程从用户态到内核态的代价小很多

协程的特点在于是一个线程执行

## 协程 VS 线程

1. 协程极高的执行效率：因为协程切换由程序自身控制，因此没有线程切换的开销。和多线程比，线程数量越多，协程的性能优势就越明显。

2. 不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突。在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。


# 虚拟内存
程序运行需要的内存远超过机器的物理内存，通过 虚拟内存可以让程序可以拥有超过系统物理内存大小的可用内存空间。另外，虚拟内存为每个进程提供了一个一致的、私有的地址空间，它让每个进程产生了一种自己在独享主存的错觉（每个进程拥有一片连续完整的内存空间）

## 虚拟地址到物理地址的转换
每个进程都有一个页表，里面存放的是虚拟地址到物理地址的映射关系。具体的翻译工作由内存管理单元负责，当他收到一个虚拟地址，他会去页表查对应的物理地址。如果没找到就会把对应的虚拟页加载到内存中